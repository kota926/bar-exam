FROM node:16.13.1-alpine3.14

ARG EMAIL_HOST \
    EMAIL_PORT \
    EMAIL_ADDRESS \
    EMAIL_PASSWORD \
    FRONTEND_URL \
    CORS_URL \
    DB_HOST \
    DB_PORT \
    DB_USERNAME \
    DB_PASSWORD \
    DB_DATABASE


ENV EMAIL_HOST=${EMAIL_HOST} \
  EMAIL_PORT=${EMAIL_PORT} \
  EMAIL_ADDRESS=${EMAIL_ADDRESS} \
  EMAIL_PASSWORD=${EMAIL_PASSWORD} \
  FRONTEND_URL=${FRONTEND_URL} \
  CORS_URL=${CORS_URL} \
  DB_HOST=${DB_HOST} \
  DB_PORT=${DB_PORT} \
  DB_USERNAME=${DB_USERNAME} \
  DB_PASSWORD=${DB_PASSWORD} \
  DB_DATABASE=${DB_DATABASE}

WORKDIR /node

RUN apk update

COPY ./api/package*.json ./

RUN npm install --production

COPY ./api/ ./

EXPOSE 8080

RUN npm run build

CMD ["npm", "run", "start"]